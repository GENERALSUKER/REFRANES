<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>El Gran Libro de los Refranes</title>
    <link href="https://fonts.googleapis.com/css2?family=Lora:ital,wght@0,400;0,700;1,400&family=Playfair+Display:wght@700;900&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #7d5a50; /* Marrón elegante */
            --success: #4e7a3a; /* Verde bosque */
            --error: #a33b3b;   /* Rojo arcilla */
            --dark: #2c2420;
            --bg: #fdf6e3;      /* Color pergamino */
            --paper: #ffffff;
        }

        body {
            font-family: 'Lora', serif;
            background-color: var(--bg);
            background-image: radial-gradient(#e5d9c3 1.5px, transparent 1.5px);
            background-size: 30px 30px;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            color: var(--dark);
        }

        #game-container {
            background: var(--paper);
            padding: 3rem;
            border-radius: 4px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.15);
            border: 1px solid #e0d5c1;
            width: 90%;
            max-width: 650px;
            text-align: center;
            position: relative;
        }

        .hidden { display: none !important; }

        h1 { 
            font-family: 'Playfair Display', serif; 
            font-size: 2.2rem;
            color: var(--primary);
            margin-top: 0;
            border-bottom: 2px double var(--primary);
            display: inline-block;
            padding-bottom: 10px;
        }

        #progress {
            font-style: italic;
            color: #999;
            font-size: 0.85rem;
            letter-spacing: 2px;
            text-transform: uppercase;
            margin-bottom: 20px;
        }
        
        .refran-box {
            font-size: 1.5rem;
            margin: 40px 0;
            line-height: 1.6;
        }

        .part1 { font-weight: bold; color: var(--dark); display: block; margin-bottom: 15px; }
        
        input[type="text"] {
            width: 100%;
            padding: 12px;
            font-family: 'Lora', serif;
            font-size: 1.2rem;
            border: none;
            border-bottom: 2px solid var(--primary);
            background: transparent;
            text-align: center;
            outline: none;
        }

        button {
            background: var(--primary);
            color: white;
            border: none;
            padding: 15px 35px;
            font-family: 'Playfair Display', serif;
            font-size: 1rem;
            font-weight: bold;
            cursor: pointer;
            margin-top: 25px;
            transition: all 0.3s;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        button:hover:not(:disabled) { background: var(--dark); transform: translateY(-2px); }
        button:disabled { background: #ccc; cursor: not-allowed; }

        .feedback {
            margin-top: 25px;
            padding: 20px;
            font-size: 1.1rem;
            border: 1px solid transparent;
        }

        .correct { background-color: rgba(78, 122, 58, 0.1); color: var(--success); border-color: var(--success); }
        .wrong { background-color: rgba(163, 59, 59, 0.1); color: var(--error); border-color: var(--error); }

       .explanation {
    font-style: italic;
    margin-top: 15px;
    color: #555;
    background: #fdfbf7;
    padding: 15px;
    text-align: justify;
    border-top: 1px solid #eee;
    white-space: pre-wrap; /* Esta línea hace que respete tus saltos de línea */
}

        .timer-text { font-size: 0.85rem; color: #999; margin-top: 15px; }
    </style>
</head>
<body>

<div id="game-container">
    <div id="screen-start">
        <h1>Sabiduría Popular</h1>
        <p id="start-msg">Cargando sabiduría...</p>
        <p>Refranes sacados del libro: "Los 200 refranes más famosos del idioma castellano".</p>
        <button onclick="startGame()">Abrir el Libro</button>
    </div>

    <div id="screen-game" class="hidden">
        <div id="progress">Pregunta 1 de 25</div>
        <div class="refran-box">
            <span class="part1" id="display-part1"></span>
            <input type="text" id="user-input" placeholder="Escribe aquí el final..." autocomplete="off">
        </div>
        <button id="btn-submit" onclick="checkAnswer()">Comprobar</button>

        <div id="feedback-area" class="hidden">
            <div id="feedback-msg" class="feedback"></div>
            <div id="explanation-text" class="explanation"></div>
            <div id="timer-msg" class="timer-text"></div>
            <button id="btn-next" class="hidden" onclick="nextQuestion()">Siguiente Refrán</button>
        </div>
    </div>

    <div id="screen-end" class="hidden">
        <h1>Fin del Camino</h1>
        <p id="final-score" style="font-size: 1.8rem; margin: 20px 0;"></p>
        <button onclick="location.reload()">Empezar de Nuevo</button>
    </div>
</div>

<script>
    // LISTA DE REFRANES (Corregida)
    const allRefranes = [
        { 
            p1: "NI HIERBA EN EL TRIGO,", 
            p2: "NI SOSPECHA EN EL AMIGO", 
            m: `Porque no se debe dejar que creciendo la mala hierba llegue a ahogar el trigo, ni aun que prospere en un sembrado, si se quiere que la cosecha sea óptima; como tampoco debe empañarse la amistad con una sombra de duda acerca de la honestidad de nuestro amigo. Si hemos de mantener limpio el trigo para que dé buen pan, con mayor razón habremos de confiar en el amigo, que es —o debe ser— como una prolongación de nosotros mismos y que, siempre, es un regalo de Dios.` 
        },
         { 
            p1: "HAZ BIEN", 
            p2: "Y NO MIRES A QUIEN", 
            m: `Porque sólo así el bien que hagas será realmente un bien y no un simple gesto farisaico. Y haz el bien aunque el destinatario nunca llegue a saberlo o, mejor, procurando incluso que no lo sepa: así, lo que hagas por los demás cumplirá el mandato evangélico de que no sepa tu mano izquierda lo que haga la derecha.
            No esperes nunca pago ni compensación por el bien que a otros hagas: hazlo, simplemente. Y vete pronto, sin mirar a quién se lo has hecho; sin intención alguna de discriminar; sin dejar que tu orgullo, o tu envidia, o tu estupidez, te impidan dejar el bien tras de ti. Confórmate con que el que lo reciba se encuentre con que alguien —no importa quién— ha sabido su necesidad y ha usado de caridad con su semejante. 
            Pocas cosas hay en la vida más interesantes que dar desinteresadamente.` 
        },
        {
            p1: "A MAL TIEMPO",
            p2: "BUENA CARA",
            m: `Pues, ¿qué mérito tiene estar contento en la prosperidad, sentirnos orgullosos de nuestros éxitos, o disfrutar tranquilamente de nuestra posición privilegiada?
                Pero estar íntimamente alegre cuando las cosas se nos ponen cuesta arriba y pensar que todo ha de pasar, mejorando, si aportamos nuestro empeño en que así sea, ayudándonos para que Dios nos ayude, sin perder la fe ni la esperanza, con la mente abierta a cualquier sugerencia positiva, sin renegar de nuestra suerte ni echarle la culpa al destino de lo que tal vez seamos nosotros los únicos culpables, eso sí tiene mérito; y así templaremos nuestro espíritu, que ha de ser en definitiva quien nos ha de sacar del atolladero. Porque sólo con un espíritu fuerte podremos y sabremos triunfar de la desgracia.`
        },
        {
            p1: "DINEROS DE SACRISTÁN, CANTANDO SE VIENEN",
            p2: "CANTANDO SE VAN",
            m: `¡Qué cierto es que se aprecia poco lo que cuesta poco conseguir! En cambio, lo que exige de nosotros una gran dedicación, sacrificios, trabajo y sinsabores lo tenemos en más estima y tanto más lo queremos cuanto más arduo ha sido para nosotros el alcanzarlo.

Si, por lo contrario, para tenerlo nos ha bastado con tender la mano y cogerlo, es muy probable que no tenga en nosotros ningún arraigo y, por tanto, poco o nada nos costará desprendernos de ello. Siempre pensaremos que podremos tener otro igual o mejor con el mismo escaso trabajo que para conseguir ese hubimos de hacer.`
        },
        {
            p1: "DIME CON QUIÉN ANDAS",
            p2: "Y TE DIRÉ QUIÉN ERES",
            m: `Pues nuestras inclinaciones y nuestros sentimientos harán que busquemos la compañía de los que creamos más afines a nosotros y a nuestro modo de entender la vida. Que es muy difícil hacer buenas migas con quienes no encajan en nuestra particular manera de ser y, en cambio, trabamos amistad enseguida con quienes piensan y obran como creemos que debe hacerse. Y, así, estamos en amor y compañía con nuestros iguales y nos sentimos incómodos cuando nos vemos obligados a rodearnos de gentes que no son como nosotros, ni hablan de lo que nos interesa, ni entre ellos estamos como entre iguales.`
        },
        {
            p1: "EL QUE A BUEN ÁRBOL SE ARRIMA",
            p2: "BUENA SOMBRA LO COBIJA",
            m: `¿Qué sombra ha de dar un árbol canijo? ¿Quién buscará frescor en pleno estío junto a un arbolito desmedrado? ¿Cómo podrá prestarnos ayuda quien está más necesitado de la nuestra?

Sólo el árbol frondoso nos refrescará ante el ardor del sol; sólo el que pueda podrá librarnos del apuro; sólo donde hay abundancia podremos hallar quien nos atienda. Porque, ¿de qué le sirve al ciego que lo guíe otro ciego? Busca el cobijo de los magnánimos y encontrarás tranquilidad en tus inquietudes y ayuda en tus cuitas.`
        },
         {
            p1: "MÁS VALE TARDE",
            p2: "QUE NUNCA",
            m: `Se dice así de todo lo que se espera y tarda en llegar, pero llega al fin. Por lo general, se trata de algo que esperamos con deseo, que lo indeseable nadie lo espera. Eso mismo hace que estemos intranquilos y se nos pase el tiempo con una lentitud agobiante. Los minutos son larguísimos; las horas, interminables, y los días, eternos. La desesperación de la espera (hay otro refrán que dice: "el que espera, desespera") nos va recomiendo por dentro y nada hay que nos consuele o nos distraiga de la decepción: todo nuestro espíritu está apabullado por esa incertidumbre...
Hasta que, por último, llega lo esperado, a veces cuando ya habíamos desechado por completo la esperanza de que alguna vez habría de producirse esa llegada. Y es entonces cuando nos damos cuenta de que, efectivamente, lo que se espera puede llegar cuando quiera: siempre será bien recibido, por mucho que tarde, a condición de que esa tardanza no se haga eterna; que sea —como afirma el refrán— “tarde, pero no nunca”.`
        },
         {
            p1: "A BUEN HAMBRE",
            p2: "NO HAY PAN DURO",
            m: `Que la necesidad es buena ablandadora. Y no sólo se trata de necesidad monda y lironda, sino que cuando se tiene voluntad de llevar a cabo una empresa, los obstáculos se hacen mucho menos graves e insalvables que cuando se acomete con poca gana o simplemente “para cumplir”; y también la afición cuenta en ocasiones, ya que no la mera voluntad, para embarcarnos en aventuras o acciones que sin esa inclinación previa de nuestro ánimo rehuiríamos las más de las veces. Por eso, lo que el hambre es al pan duro, la voluntad —la gana— lo es a los aconteceres de la vida diaria, a la que no hay duda que hay que saber “hincarle el diente” a cada momento.`
        },
         {
            p1: "A CABALLO COMEDOR,",
            p2: "CABESTRO CORTO",
            m: `Viene esto a cuento de la necesidad de refrenar los ímpetus irrefrenados y, sobre todo, a las pasiones, que de suyo son ya irracionales.
Porque el verdadero hombre no es el que sigue sin más los dictados de su capricho, sino el que sabe tirar a tiempo de las riendas de ese caballo presto al mordisco devorador que todos llevamos dentro. Dejar que el caballo nos lleve adonde quiera y como se le antoje no es de buen jinete; hacer que vaya adonde queremos y al paso que nos conviene, sí. Y para ello hay que tener la mano firme, que no dura, ni mucho menos, porque la dureza es otra cosa que no tiene nada que ver con la buena conducción.`
        },
         {
            p1: "A CADA PAJARILLO",
            p2: "PARÉCELE BIEN SU NIDO",
            m: `Desde los inaccesibles y rocosos de las águilas hasta los frágiles y suaves de los pardales, están todas las aves contentas con su hogar, y todas lo defienden hasta donde llegan sus fuerzas contra intrusos y depredadores. ¿Por qué, pues, no ha de parecernos a nosotros, los hombres, que nuestro hogar, nuestra casa, nuestra familia, son los mejores del mundo? Y así es: que cada uno está en ella más a gusto y feliz que en el mejor y más lujoso de los hoteles, y aunque sepamos —que lo sabemos— que hay otras casas mayores y más lujosas que la nuestra, porque siempre habrá otra mejor por buena que ella sea, es lo cierto que no la cambiaríamos por nada del mundo.
Que la casa no son sólo las cuatro paredes donde se vive, sino la familia entera y los muebles y enseres que se tienen, y los recuerdos unidos a todos ellos, que es lo que en conjunto forma en realidad nuestra historia. Porque lo que el territorio es para la historia de las naciones es el hogar para la propia de todos y cada uno de nosotros: esas pequeñas historias que en unión —no lo olvidemos— es lo que en realidad constituye la verdadera historia de la humanidad.`
        },

        // Puedes añadir más aquí siguiendo el mismo formato
    ];

    let currentGameList = [];
    let currentIndex = 0;
    let score = 0;
    let timer;

    // Actualizar mensaje inicial según cantidad de refranes disponibles
    document.getElementById('start-msg').innerText = `¿Podrás completar los ${Math.min(allRefranes.length, 25)} refranes elegidos al azar?`;

    function startGame() {
        if (allRefranes.length === 0) {
            alert("No hay refranes cargados.");
            return;
        }

        // 1. Mezclar y seleccionar
        const shuffled = [...allRefranes].sort(() => 0.5 - Math.random());
        const totalAUsar = Math.min(shuffled.length, 25);
        currentGameList = shuffled.slice(0, totalAUsar);
        
        currentIndex = 0;
        score = 0;
        
        document.getElementById('screen-start').classList.add('hidden');
        document.getElementById('screen-game').classList.remove('hidden');
        showQuestion();
    }

    function showQuestion() {
        const refran = currentGameList[currentIndex];
        document.getElementById('progress').innerText = `Refrán ${currentIndex + 1} de ${currentGameList.length}`;
        
        document.getElementById('display-part1').innerText = refran.p1;
        document.getElementById('user-input').value = "";
        document.getElementById('user-input').disabled = false;
        document.getElementById('btn-submit').classList.remove('hidden');
        document.getElementById('btn-submit').disabled = false;
        document.getElementById('feedback-area').classList.add('hidden');
        document.getElementById('btn-next').classList.add('hidden');
        
        // Pequeño delay para el foco en móviles
        setTimeout(() => document.getElementById('user-input').focus(), 100);
    }

    function normalizeText(str) {
        return str.normalize("NFD").replace(/[\u0300-\u036f]/g, "").toLowerCase().trim().replace(/[.,\/#!$%\^&\*;:{}=\-_`~()]/g,"");
    }

    function checkAnswer() {
        const userInput = normalizeText(document.getElementById('user-input').value);
        const correctAnswer = normalizeText(currentGameList[currentIndex].p2);
        
        const feedbackMsg = document.getElementById('feedback-msg');
        document.getElementById('user-input').disabled = true;
        document.getElementById('btn-submit').disabled = true;
        document.getElementById('feedback-area').classList.remove('hidden');
        
        if (userInput === correctAnswer) {
            feedbackMsg.innerText = "✒️ ¡Correcto!";
            feedbackMsg.className = "feedback correct";
            score++;
        } else {
            feedbackMsg.innerText = `✘ Incorrecto. Lo sabio es: "${currentGameList[currentIndex].p2}"`;
            feedbackMsg.className = "feedback wrong";
        }

        document.getElementById('explanation-text').innerText = currentGameList[currentIndex].m;
        startTimer();
    }

    function startTimer() {
        let timeLeft = 15;
        const timerMsg = document.getElementById('timer-msg');
        const btnNext = document.getElementById('btn-next');
        
        if (timer) clearInterval(timer);
        
        timerMsg.innerText = `Podrás continuar en ${timeLeft} segundos...`;
        
        timer = setInterval(() => {
            timeLeft--;
            if (timeLeft > 0) {
                timerMsg.innerText = `Podrás continuar en ${timeLeft} segundos...`;
            } else {
                clearInterval(timer);
                timerMsg.innerText = "";
                btnNext.classList.remove('hidden');
            }
        }, 1000);
    }

    function nextQuestion() {
        currentIndex++;
        if (currentIndex < currentGameList.length) {
            showQuestion();
        } else {
            endGame();
        }
    }

    function endGame() {
        document.getElementById('screen-game').classList.add('hidden');
        document.getElementById('screen-end').classList.remove('hidden');
        document.getElementById('final-score').innerText = `Puntuación: ${score} / ${currentGameList.length}`;
    }

    // Soporte para tecla Enter
    document.getElementById('user-input').addEventListener('keypress', (e) => {
        if (e.key === 'Enter' && !document.getElementById('btn-submit').disabled) {
            checkAnswer();
        }
    });
</script>
</body>
</html>
